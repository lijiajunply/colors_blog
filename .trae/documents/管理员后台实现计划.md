# 管理员后台实现计划

## 项目结构分析
- 项目使用 Next.js 13+ App Router 模式
- 已有的服务层和 Prisma ORM
- 管理员后台基础 layout 已存在
- 已实现主题提供者，支持暗黑/亮色主题切换

## 实现内容

### 1. 文章管理
- 创建文章列表页面（列表展示、搜索、分页）
- 创建文章编辑页面（新增/编辑文章）
- 实现文章删除功能

### 2. 评论管理
- 评论列表展示
- 评论审核功能
- 评论删除功能

### 3. 用户管理
- 用户列表展示
- 用户权限管理（设置管理员/普通用户）
- 用户删除功能

### 4. 系统设置
- 系统配置列表
- 配置项编辑功能

### 5. 项目管理
- 项目列表展示
- 项目编辑页面（新增/编辑项目）
- 项目删除功能

### 6. 标签管理
- 标签列表展示
- 标签编辑功能（新增/编辑标签）
- 标签删除功能

## 技术实现
- **使用 Next.js 13+ 服务器组件**：所有页面和组件默认使用服务器渲染
- **直接使用 Prisma ORM**：在服务器组件中直接调用数据库操作，不通过 API 路由
- **使用服务器操作**：实现表单提交和数据更新
- **复用现有的服务层代码**：直接调用服务层方法
- **使用 Headless UI + Tailwindcss 实现 UI**：确保良好的用户体验
- **集成现有主题提供者**：支持暗黑/亮色主题切换
- **实现响应式设计**：适配不同屏幕尺寸
- **添加表单验证**：确保数据完整性
- **实现权限控制**：只有管理员可以访问

## 文件结构
```
src/app/admin/
├── articles/
│   ├── page.tsx          # 文章列表（服务器组件）
│   ├── actions.ts        # 文章相关服务器操作
│   ├── create/           # 新增文章
│   │   └── page.tsx      # 新增文章表单（服务器组件）
│   └── [id]/             # 编辑文章
│       └── page.tsx      # 编辑文章表单（服务器组件）
├── comments/
│   ├── page.tsx          # 评论管理（服务器组件）
│   └── actions.ts        # 评论相关服务器操作
├── users/
│   ├── page.tsx          # 用户管理（服务器组件）
│   └── actions.ts        # 用户相关服务器操作
├── settings/
│   ├── page.tsx          # 系统设置（服务器组件）
│   └── actions.ts        # 设置相关服务器操作
├── projects/
│   ├── page.tsx          # 项目列表（服务器组件）
│   ├── actions.ts        # 项目相关服务器操作
│   ├── create/           # 新增项目
│   │   └── page.tsx      # 新增项目表单（服务器组件）
│   └── [id]/             # 编辑项目
│       └── page.tsx      # 编辑项目表单（服务器组件）
├── tags/
│   ├── page.tsx          # 标签列表（服务器组件）
│   └── actions.ts        # 标签相关服务器操作
├── layout.tsx            # 管理员布局（集成主题提供者和导航）
└── page.tsx              # 仪表盘（服务器组件）
```

## 核心实现方式

### 1. 数据获取
- 使用服务器组件直接调用 Prisma ORM 进行数据查询
- 示例：
  ```typescript
  // src/app/admin/articles/page.tsx
  import { prisma } from '@/lib/prisma';
  
  export default async function ArticlesPage() {
    const articles = await prisma.article.findMany({
      orderBy: { createdAt: 'desc' },
    });
    
    return (
      // 文章列表渲染
    );
  }
  ```

### 2. 表单提交
- 使用 Next.js 服务器操作（Server Actions）实现表单提交
- 示例：
  ```typescript
  // src/app/admin/articles/actions.ts
  'use server';
  
  import { prisma } from '@/lib/prisma';
  
  export async function createArticle(data: FormData) {
    const title = data.get('title') as string;
    const content = data.get('content') as string;
    
    await prisma.article.create({
      data: { title, content },
    });
  }
  ```

### 3. 权限控制
- 在服务器组件中检查用户身份
- 实现路由保护
- 示例：
  ```typescript
  // src/app/admin/layout.tsx
  import { getCurrentUser } from '@/hooks/useAuth';
  
  export default async function AdminLayout({ children }: { children: React.ReactNode }) {
    const user = await getCurrentUser();
    
    if (!user || user.identity !== 'admin') {
      // 重定向到登录页
    }
    
    return (
      // 布局渲染
    );
  }
  ```

### 4. UI 组件
- 使用 Headless UI 组件库
- 使用 Tailwindcss 进行样式设计
- 支持暗黑/亮色主题切换
- 实现响应式设计

### 5. 表单处理
- 使用 HTML 表单结合服务器操作
- 添加表单验证
- 实现表单提交反馈

### 6. 数据展示
- 实现表格组件
- 支持分页
- 支持搜索和筛选
- 支持排序

## 交互体验
- 添加加载状态
- 添加成功/错误提示
- 实现确认对话框
- 优化移动端体验

## 部署和优化
- 优化数据库查询性能
- 实现缓存策略
- 确保服务器组件高效运行

## 实现步骤

1. **更新管理员布局**：集成主题提供者和导航菜单
2. **实现仪表盘**：显示系统概览
3. **实现文章管理**：列表、创建、编辑、删除
4. **实现评论管理**：列表、审核、删除
5. **实现用户管理**：列表、权限设置、删除
6. **实现系统设置**：配置项管理
7. **实现项目管理**：列表、创建、编辑、删除
8. **实现标签管理**：列表、创建、编辑、删除
9. **添加权限控制**：确保只有管理员可以访问
10. **优化用户体验**：添加加载状态、错误提示等

## 技术栈
- Next.js 13+ App Router
- Prisma ORM
- Headless UI
- Tailwindcss
- React 18
- TypeScript